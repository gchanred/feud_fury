<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Feud Fury – Moderator</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    h1 { font-size: 3em; }
    h2 { font-size: 2em; }
  </style>
</head>
<body>
  <!-- Background music and sound effects -->
  <audio id="bg-music" src="{{ url_for('static', filename='background_music.mp3') }}" loop autoplay muted preload="auto"></audio>
  <audio id="correct-sound" src="{{ url_for('static', filename='correct.wav') }}" preload="auto"></audio>
  <audio id="wrong-sound" src="{{ url_for('static', filename='wrong-buzzer.wav') }}" preload="auto"></audio>

  <h1>FEUD FURY – Moderator</h1>
  <br>
  <br>
  
  <div class="nav-container">
    <button onclick="toggleMusic()">Mute/Unmute Music</button>
    
    <button onclick="window.location.href='{{ url_for('round_setup') }}'">Setup New Round</button>
    
    <button onclick="window.open('{{ url_for('contestant') }}','_blank')">Contestant Screen</button>
  </div>
  
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <ul class="flashes">
      {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
      {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}
  
  <hr>
  
  <form method="post" action="{{ url_for('start_next_question') }}">
    <button type="submit">Start / Next Question</button>
  </form>
  
  {% if state.current_question %}
  <section>
    <h2>Question  {{ state.current_question_index + 1 }} of {{ state.chosen_questions|length }}:</h2>
    <span style="text-transform:uppercase"><p>{{ state.current_question.question }}</p></span>
    <form method="post" action="{{ url_for('show_question') }}">
      <button type="submit">Show Question to Contestants</button>
    </form>
    <h3>Answers</h3>
    <span style="text-transform:uppercase">
      <ul id="answers">
      {% for answer in state.current_question.answers %}
        {% set i = loop.index0 %}
        <li>
          {{ loop.index }}. {{ answer[0] }} ({{ answer[1] }} pts)
          {% if not state.answers_revealed[i] %}
            <form method="post" action="{{ url_for('reveal_answer', index=i) }}" style="display:inline;" onsubmit="return playSoundAndSubmit(event, 'correct-sound');">
              <button type="submit">Reveal</button>
            </form>
          {% else %}
            <span> - Revealed</span>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </span>
  </section>
  {% endif %}
  
  <section>
    <form method="post" action="{{ url_for('strike') }}" onsubmit="return playSoundAndSubmit(event, 'wrong-sound');">
      <button type="submit">Strike</button>
    </form>
    {% if state.is_steal_attempt %}
      <form method="post" action="{{ url_for('steal_success') }}" style="display:inline;">
        <button type="submit">Steal Successful</button>
      </form>
      <form method="post" action="{{ url_for('steal_failed') }}" style="display:inline;">
        <button type="submit">Steal Failed</button>
      </form>
    {% endif %}
  </section>
  
  <section>
    <h3>Scores</h3>
    <form method="post" action="{{ url_for('update_scores') }}">
      Team {{ state.team1_name }}:
      <input type="text" name="team1_score" value="{{ state.team1_score }}">
      Team {{ state.team2_name }}:
      <input type="text" name="team2_score" value="{{ state.team2_score }}">
      <button type="submit">Update Scores</button>
    </form>
  </section>
  
  <section>
    <p>Team in Play: 
      {% if state.current_control_team == 1 %}
        {{ state.team1_name }}
      {% elif state.current_control_team == 2 %}
        {{ state.team2_name }}
      {% else %}
        Not set
      {% endif %}
    </p>
    <p>Strikes: {{ state.team_in_play_strikes }}</p>
  </section>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.min.js"></script>
  <script>
    var socket = io();
    socket.on('state_update', function(data){
      // For moderator, you might update specific elements as needed.
      // (Since flash messages are handled by page reloads, we’re not auto-updating those.)
    });

    function toggleMusic() {
      var music = document.getElementById("bg-music");
      if(music.muted) {
        music.muted = false;
        music.play();
      } else {
        music.muted = true;
      }
    }
    function playSoundAndSubmit(event, soundId) {
      event.preventDefault();
      var sound = document.getElementById(soundId);
      if (sound) {
          sound.currentTime = 0;
          sound.play();
      }
      setTimeout(function() {
          event.target.submit();
      }, 2000);
      return false;
    }
  </script>
</body>
</html>
